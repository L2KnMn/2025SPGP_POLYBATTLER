# 2025SPGP 
## Poly Battler
2025년 스마트폰게임프로그래밍 수업 텀프로젝트 개발 게임\
by 게임공학과 이관민

![Lobby Image](https://github.com/user-attachments/assets/d73ca04d-e420-4f11-a413-d50f8aa1418d)

**게임 컨셉: 도형을 이용해 표현한 캐릭터, 오토배틀러 장르식 게임 진행**

환경
  - 세로 환경에서 게임을 한다고 가정
  - landscape로 휴대폰이 바뀌어도 화면이 그대로 portrait로 유지된다고 가정한다
  - 한손으로 엄지만으로 조작하기 쉬운 게임을 만든다

---

예상 게임 실행 흐름

게임 흐름도
![흐름도](https://github.com/user-attachments/assets/0808535a-b2dc-4766-8ecc-43756df99e80)

---

개발 범위

로비 
  - 대문
  - 게임 시작
  - 전적 기록 : 이전 게임 기록을 저장해뒀다가 불러오기
    - 로비 액티비티에서 Custom View를 통해 기록(언제, 몇 라운드까지 갔는지, 마지막 단계 사용한 조합)을 윈도우로 보여주기
    - 기록 삭제 기능

게임 진행 
  - 10라운드 정도 진행하면서 덱 빌딩
    - 10라운드 완료 되면, 게임 클리어 UI 보여주고 마무리
    - 모든 캐릭터 사망하면 그 전 라운드까지 클리어 기록으로 인정하고 기록 보여줌
    - 유저가 결과를 확인하면 데이터 저장하고 게임 액티비티를 정리하고 로비로 이동함
  - 플레이어 캐릭터
    - 별도로 구현할 예정 없음
    - 터치 조작을 위한 커서나 터치 이펙트 정도 구현할 가능성 있음
  - 게임 캐릭터 동그라미, 네모, 세모 등의 간단한 도형 및 빨간색, 파란색, 초록색 등 색으로 캐릭터 표현, 한 번에 최대 5개의 캐릭터가 파티로 전투 가능하도록 함
    - 동그라미 : 원거리 공격 캐릭터, 낮은 공격력, 범위 공격, 낮은 체력
    - 네모 : 근거리 공격 캐릭터, 높은 공격력, 단일 공격, 높은 체력
    - 세모 : 원거리 공격 캐릭터, 높은 공격력, 단일 공격, 낮은 체력
    - 빨간색, 파란색, 초록색 세 가지 색상 간에 시너지 2 / 4 / 5 단위 버프
    - 도형 숫자 별로 버프 2 / 3 / 4 / 5 단위 버프
      - 캐릭터는 도형마다 다르게 행동하므로, Polyman class를 상속 받은 별도의 3개의 클래스로 구분하고, 색깔은 속성으로만 구분해서 표현할 예정
  - 밴치 : 5개까지 상점에서 산 캐릭터를 저장해뒀다가 맵으로 내볼 수 있도록 함
  - 진형 시너지 : 캐릭터 도형, 색 별로 같은 것들이 모일 때마다 간단한 버프 요소
    - 기본적인 전투 시스템의 뼈대가 만들어지면 버프 효과 같은 것을 얹어서 만들 생각임
  - 상점 : 게임 진행 중 매 라운드마다 종료 후 상점 이용 가능
    - 상점에서 한 번에 3개식 캐릭터를 표시해서 구매 가능
    - 이미 있는 캐릭터 판매 -> 별도로 판매 창을 만들지 끌어다가 넣을지 
    - 리롤 기능
  - 조합 : 같은 색, 도형 캐릭터를 3개가 모이면 자동 레벨업 -> 2레벨까지 표현
    - 2레벨 캐릭터는 별도의 캐릭터보단 도형 별로 구분한 클래스 내에서 레벨에 따라 다르게 그리는 식으로 표현할 생각임
    - 현재 생각 중인 방식은 레벨에 따라 캐릭터 주위에 뭔가 이펙트가 추가되는 식 이미 크기는 한 칸에 딱 맞게 그리기 때문에 
  - 맵 : 사각형으로 7 * 4 정도 크기로 구현 플레이어는 아래 편에 3 * 4 사이즈 맵에 자기 캐릭터를 배치해서 진형을 만들도록 하고 자동 전투 진행
    - 배치할 수 없는 부분은 가시성을 위해 좀 더 어둡게 필터를 씌워서 구분감 있도록
    - 배치할 때 배치 예상 되는 부분 표시하는 기능 -> 구현 완료
      - 만일 배치할 수 없는 곳에 가져가면 자동으로 적절한 위치 혹은 이전 초기 위치 등으로 예상 배치 이펙트가 옮겨감
      - 밴치에서 5명 이상 끌어오거나, 하면 마찬가지로 밴치로 예상 이동 지점 표시하고 이동 불가능하게 처리할 예정
    - 맵과 밴치는 기능적으로 비슷한 점이 있음
      - 다만, 같은 클래스를 이용해서 구현하거나, 상속 하기에도 차이점 존재
      - 따로 클래스를 만들기보단 맵 내에 밴치를 추가해서 별도 처리하는 방식으로 할 생각임
      - 맵과 밴치 모두 오가면서 표시할 수 있게 현재는 맵 내에 예상 배치 기능이 포함되어 있지만 분리해서 따로 커서 클래스 구현할 생각
  - 에너미 : 똑같이 동그라미 세모 네모 등의 도형 등장, 검은색 필터를 씌워서 구분감 있도록 할 생각임. 엘리트 에너미는 아직 기획 없음.
    - 적의 숫자는 제한 없음 한 번에 최대 3 * 4 숫자가 등장 가능
    - 웨이브 별도 고려 안 함 -> 한 번에 다 등장 
    - 적의 조합 패턴은 라운드 별로 미리 생성해서 json이나 xml로 저장해뒀다가 사용함
    - 적의 조합에 추가로 이전 라운드 클리어 기록을 가져와서 등장하도록 함
    - 별도의 클래스로 구현하지 않고 IEnemy 인터페이스를 만들어서 구분할 생각임 

  - 게임 정산
    - 게임 오버 혹은 10라운드까지 게임 클리어 -> UI로 결과 보여주기
    - 터치 등으로 확인 하면 로비로 돌아가면서 덱을 점수와 함께 기록 -> 이 기록된 덱은 후에 다음 게임에 활용 및 점수 랭킹으로 확인
   
  - 게임 프레임워크
    - 수업 시간에 진행한 프레임워크에 필요한 클래스를 추가로 구현해서 사용 중
      - IGameObject로 게임 오브젝트를 구분함
      - Transform 클래스를 만들어서 게임뷰 내에서 그려질 인스턴스 뿐 아니라 이펙트처럼 크기, 좌표 등을 가지는 모든 객체가 이 클래스를 가지고 상호작용하고, 파라미터로 넘겨줘서 사용함
        - IGameObject는 반드시 getTransform을 가지므로 모든 IGameObject를 상속 받는 게임 오브젝트들은 Transform을 구현하도록 함
        - Rigidbody 변수를 가지고 캐릭터처럼 한 칸에 하나씩만 존재하는 것과 겹쳐도 상관 없는 것을 구분
        - 충돌 계산 등도 이 클래스 내부에 구현해서 처리
      
---

게임의 레퍼런스

![레퍼런스](https://github.com/user-attachments/assets/0224e5c9-578c-454d-abc8-ff32e522e931)

![image](https://github.com/user-attachments/assets/f966dbb1-ae6a-4701-b3ba-6e972059cc56)

게임 전투 진행 컨셉 이미지

![image](https://github.com/user-attachments/assets/8f545e94-d683-4f98-84a7-06d5c6786792)

![image](https://github.com/user-attachments/assets/915135a6-4bf0-4f97-af23-de1fed1f381e)

게임 상점 컨셉 이미지

---

*개발 일정*\
~4월 2주차 : 로비, 메인 게임 이동 및 게임 종료 후 로비로 돌아오 기능, 메인 게임에 맵 및 밴치에 캐릭터 배치~=>완료

~4월 3주차 : 게임 캐릭터 드래그 앤 드랍, 상점 기능, 전투 단계 진입(Scene 내의 상태 전환), 오브젝트들의 상태 전환, UI(상점, 버튼, 토스트, 텍스트박스 등)~ => 완료

~4월 4주차 : 에너미 캐릭터 생성, 전투 기능(이동, 공격, HP 등) 구현, 에너미 캐릭터 및 AI 구현, 10단계 라운드 동안 적 캐릭터 생성, 전투 등의 루프 구현~ => 완료

~4월 5주(5월 1주차): 전투 결과 데이터 저장 및 불러오기 구현~

~5월 2주차 : 애니메이션 등의 퀄리티 및 이펙트 등 시각 효과 향상~

~5월 3주차 : 진형 시너지, 2레벨 조합 및 레벨 디자인(상점 구매 가격, 새로 고침 가격, 라운드 별 보상)~

5월 4주차 : 게임 사운드, 버그 수정 및 완성도 향상

---

진행 상황
- 게임 기능 ( 80% )
  - 전투 ( 90% ) : 기능 모두 구현 완료, 시각적 효과도 아직 부족
    - 캐릭터 ( 100% ) : 기본 객체는 구현 완료 되었음 합성 및 레벨 등을 구현하지 완료 -> 시너지 효과 UI가 아직 개선 중
    - 적 ( 100% ) : json 파일을 통해 생성 패턴 등을 저장 및 불러오기, 추가 등 필요한 것 모두 구현
  - 상점 ( 100% ) : 기능 구현 완료, 시각적으로 완성도 보강
  - 맵 ( 100% ) : 기능적으론 구현 완료
  - 조작 ( 100% ) : 예상 해두었던 기능 구현 완료
  - UI ( 90% ) : 버튼, 토스트, 텍스트 보드 등 틀은 잡아두었고, 필요한 것을 생성해서 사용 가능한 상태 다만, 아직 시각적으로 매우 단순하게 구현됨
  - 이펙트 ( 85% ) : 피격 효과 구현 중 그 외 앞으로 필요에 따라 추가될 가능성 높다고 생각했음, (합성시 Level up 효과, level이 높은 오브젝트를 구분하기 위한 효과 등) 

---

git 기록

![image](https://github.com/user-attachments/assets/87c6b600-3e8f-4a64-b1fa-499b144bfb26)

--- 

오브젝트 명세서 
- POLYGON MAN (줄여서 polyman)
  * 주요 게임 캐릭터입니다.
    * Trasnfrom : 위치 정보 저장
    * BattleUnit : 전투 시 필요한 정보 모음
    * ObjectState : 캐릭터의 상태 정보
    * ShapeType : 어떤 종류의 도형 캐릭터인지
    * ColorType : 어떤 색상의 캐릭터인지 
    - 게임 맵 위에서 동작하며, 비전투 단계에선 IDLE 상태이고, 전투를 시작하면 Battle Controller라는 객체가 전투에 참여할 Polyman들에게만 전투 시 동작할 BehaviorTree를 부여해서 자동 전투 진행합니다. Behavior Tree는 미리 코드 상에서 설계해두고 오브젝트라 생성되면 맞는 Polyman의 타입에 따라 부여받습니다.
    - 부여 받은 Behavior Tree를 작동시켜서 전투 중 동작합니다. 그 외의 상황에선 별도의 처리 없이 Idle 애니메이션으로 위치한 자리에서 가만히 존재합니다.
    - 전투 중 공격과 이동 등에 쓰는 정보는 Battle Controller에 요청합니다. 
      - 주로 공격 타겟을 설정할 때 이용합니다. 타겟이 설정되면 해당 객체의 Battle Unit을 참조해서 가지고 있게 됩니다.
    - 비전투 중 터치 이벤트가 발생하면 GameManager 객체 내부에 Drag And Drop Event Controller라는 객체가 Game Map을 참조해서 터치한 위치의 타일 위를 조사하고 그 IGameObject들 중에서 오브젝트가 있다면 그 오브젝트를 반환하여 위치 정보 및 Map 내에서 배치 정보를 조정합니다.
      - 터치를 통해 캐릭터 이동 배치, 캐릭터 간에 자리 교환 등이 가능합니다.
    - 지금은 별도의 Image 소스 없이 Canvas의 도형을 그리는 함수를 통해 그려주고 있습니다.
    - BehaviorTree
        - ConditionNode : 모든 노드가 포함하는 인터페이스
        - CompositeNode : 특정 조건 확인하고 boolean을 반환하는 노드 인터페이스 
        - ActionNode : 간단한 람다식을 포함하는 리프 노드입니다.
        - Selector : 모든 하위 자식 노드 중 하나라도 성공하면 성공을 반환하는 노드
        - Sequence : 모든 하위 노드가 성공해야지 성공하는 노드
- Game Map
  * 게임의 배경입니다. 사각형 타일로 구분되어 있고, 각 타일당 비전투 상태에선 하나의 Polyman만 배치할 수 있게 했습니다.
    * MapPart : 오브젝트를 배치 가능한 구역 역할을 하는 클래스입니다. 이 클래스로 맵의 밴치를 구현했습니다.
    * Field : MapPart를 상속 받아 만든 캐릭터가 전투를 하는 사각형 타일 모음 클래스입니다. 
    * Transform predictPoint : 플레이어가 터치와 드래그해서 상호작용 하는 오브젝트의 위치 아래에 오브젝트를 놓았을 때 배치될 예상 위치 정보를 담는 멤버 변수입니다.
    - 정확힌 Rigidbody인 것들은 겹칠 수 없고 rigidbody가 아닌 이펙트, 시각효과 등은 타일 위에 배치가 가능하도록 해주었습니다.
    - 플레이어가 터치할 때, 배치할 수 있는 위치나, 배치할 수 없는 위치, 예상되는 위치 등을 표시하는 역할도 맡고 있습니다.
- Shop
  - 게임 내 POLYMAN 캐릭터들을 구입할 수 있는 기능입니다.
    * Goods : 상품 정보입니다. 어떤 색상 및 도형 종류 캐릭터인지, 가격과 판매 상태(판매 가능한지, 품절인지 등)를 가지고 있습니다.
    - 정보는 별도의 SHOP 클래스에서 가지고 있고 이 정보를 UI 객체들을 통해 출력하고 있습니다.
    - 상점 아이콘 Image를 하나 사용 중이며, 이 아이콘을 누르면 창이 열리며 상점 기능을 이용할 수 있습니다.
    - 전투 중엔 표시되지 않다가 전투 준비 중에만 출력하도록 해주었습니다.
    - 상점엔 3개의 상자와 그 안에 판매 중인 캐릭터 정보가 출력되며 그 상자를 클릭하면 구매되어 자동으로 밴치에 배치됩니다. 이후 상점을 닫고 밴치에서 필드로 캐릭터를 이동시켜서 배치할 수 있습니다. 
    - 만약 Bench에 대기 중인 Polyman들이 있다면 덱 관리를 위해 제거할 수 있도록 판매 기능도 구현해주었습니다.
- UI
  * 5종류를 만들었습니다. UI는 별도의 공통된 interface는 없고 모두 IGameObject를 상속 받습니다. 생성과 관리도 UI 오브젝트가 각자 책임지고 실행합니다. 다만, 게임 씬의 상태 변화를 전달 받기 위해 Ui manager를 참조해서 현재 Scene의 상태를 보고 그릴지 아닐지, 유저 입력 이벤트를 받아서 처리할지 결정합니다.
    - HP Bar : Polyman의 HP를 나타내는 ui 입니다.
    - Button : 사용자의 입력으로 이벤트를 실행시키는 오브젝트입니다. IRunnable 객체를 통해 생성하는 쪽에서 이 버튼이 어떤 일을 할지 정해줍니다. 
    - Score Board : 수업 시간에 만든 score를 참고해서 만든 객체입니다. 
    - Signage : Text나 Image를 그리기만 하고 별도의 작업은 하지 않는 객체입니다. 
    - Toast Massanger : 사용자에게 간단한 메시지를 출력하기 위해 직접 구현해보았습니다. 기존 안드로이드의 토스트에 텍스트 크기나 화면에 출력되는 비율 등을 제가 정하고 싶어서 구현해보았습니다.
- Effect
   * 시각 효과를 위해 생성되고 정해진 시간 동안 동작하다가 알아서 삭제되는 객체들을 Effect로 묶어 관리해주기 위해 Effect 클래스를 상속 받아 구현했습니다.
     - Coin Effect : 적이 죽는 순간 동전을 떨어뜨리는 효과를 담당합니다.
     - Attack Effect : 각 객체간 누가 누굴 타게팅 하고 공격하는지 쉽게 알아보기 위해 만들었습니다. 
     - Damage Text Effect : 공격한 대상이 받은 데미지를 출력합니다.
     - Damage Effect : 공격할 때 피격 효과를 담당합니다.

---

스크린샷

<img src="https://github.com/user-attachments/assets/158292b9-41ea-4477-aec2-458efd17e54b" alt="Screenshot_20250512_185233" width="300">
<img src="https://github.com/user-attachments/assets/2e21f38d-80a3-4702-b536-5850a3225fd5" alt="Screenshot_20250512_185607" width="300">
<img src="https://github.com/user-attachments/assets/39eb9c84-7996-4525-8915-608080cb650f" alt="Screenshot_20250512_185626" width="300">
<img src="https://github.com/user-attachments/assets/a9edca8a-0781-4d0d-a3db-be7654219041" alt="Screenshot_20250512_185640" width="300">
<img src="https://github.com/user-attachments/assets/9a9d866f-95bb-48f0-be35-ef39f3f6e017" alt="Screenshot_20250512_185659" width="300">
<img src="https://github.com/user-attachments/assets/88a67e08-f2ef-4d38-a0e3-697628458fb2" alt="Screenshot_20250512_185718" width="300">
